pipeline {
    agent any  // Can be changed to a specific agent with Terraform installed

    environment {
        TERRAFORM_HOME = tool name: 'terraform', type: 'org.jenkinsci.plugins.terraform.TerraformInstallation'
        PATH = "${env.PATH}:${TERRAFORM_HOME}"  // Add Terraform bin directory to PATH
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', // Change branch as needed
                   credentialsId: 'your-credentials-id', // Replace with your Git credentials ID
                   url: 'https://github.com/your-user/your-repo.git'  // Replace with your Git repository URL
            }
        }

        stage('Terraform Init') {
            steps {
                sh 'terraform init' // Initialize Terraform with backend configuration (if applicable)
            }
        }

        stage('Terraform Plan') {
            steps {
                sh 'terraform plan' // Run Terraform plan to see the changes
            }
        }

        stage('Terraform Apply (Optional)') {
            when {
                expression { // Optional approval stage before applying
                    return input message: 'Apply Terraform configuration?', submitter: 'USER_ANY', ok: 'Apply'
                }
            }
            steps {
                sh 'terraform apply -auto-approve' // Apply the Terraform configuration with auto-approval
            }
        }
    }
}
